<!DOCTYPE html>
<html>
<head>
    <title>system configuration</title>
    <link href="../css/application.min.css" rel="stylesheet">
    <link rel="shortcut icon" href="img/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta charset="utf-8">
    <script src="../js/cookie.js"></script>
    <script>
        var user = getCookie("user");
        if (user) {
            addCookie("user", user);
        } else {
            window.location = "../login.html";
        }
    </script>
</head>
<body id="sizediv" class="background-dark">
<div id="logobar" class="logo">
    <h2 class="page-title">
          <img src="../img/telecom.png" style="width:50px;position: relative;top: -7px;">
        DCFabric <small>configuration management</small></h2>
</div>
<nav id="sidebar" class="sidebar nav-collapse collapse">
    <ul id="side-nav" class="side-nav">
        <li class='accordion-group'>
            <a href="../cluster_config/cluster_config.html"><i class="icon-desktop"></i> <span class="name">cluster configuration</span></a>
        </li>
        <li class='accordion-group'>
            <a href="../interchanger_desc/interchanger_desc.html"><i class="icon-desktop"></i> <span class="name">switch information</span></a>
        </li>
        <li class='accordion-group'>
            <a href="../chart/chart.html"><i class="icon-desktop"></i> <span class="name">network topo</span></a>
        </li>
     <!--   <li class='accordion-group'>
            <a href="../flow_table_config/flow_table_config.html"><i class="icon-desktop"></i> <span class="name">flow configuration</span></a>
        </li>
        <li class="accordion-group">
            <a href="../firewall_manager/firewall_config.html"><i class="icon-desktop"></i> <span class="name">firewall management</span></a>
        </li>
        <li class='accordion-group'>
            <a href="../gateway_config/gateway_config.html"><i class="icon-desktop"></i> <span class="name">L3 gateway configuration</span></a>
        </li>
        <li class='accordion-group'>
            <a href="../meter_table_config/meter_table_config.html"><i class="icon-desktop"></i> <span class="name">meter table configuration</span></a>
        </li>
        <li class='accordion-group'>
            <a href="../group_table_config/group_table_config.html"><i class="icon-desktop"></i> <span class="name">group table configuration</span></a>
        </li>
        <li class='accordion-group'>
            <a href="../multitenant_manage/renant_config.html"><i class="icon-desktop"></i> <span class="name">tenant managent</span></a>
        </li>-->
        <li class='accordion-group active'>
            <a href="../open_manage/openstack_main.html"><i class="icon-desktop"></i> <span class="name">openstack</span></a>
        </li>
         <li class='accordion-group'>
            <a href="../open_qos/openstack_qos.html"><i class="icon-desktop"></i> <span class="name">QoS manager</span></a>
        </li>
</nav>
<div id="wrapbar" class="wrap">
    <header id="headbar" class="page-header">
        <div class="navbar">
            <div class="navbar-inner">
                <ul class="nav pull-right">
                    <!--<li class="hidden-phone dropdown">
                        <a href="#" title="Account" id="account"
                           class="dropdown-toggle"
                           data-toggle="dropdown">
                            <i class="icon-user"></i>
                        </a>
                        <ul id="account-menu" class="dropdown-menu account" role="menu">
                            <li role="presentation" class="account-picture">
                                <img src="../img/2.jpg" alt="">
                                Philip Daineka
                            </li>
                            <li role="presentation">
                                <a href="form_account.html" class="link">
                                    <i class="icon-user"></i>
                                    Profile
                                </a>
                            </li>
                            <li role="presentation">
                                <a href="component_calendar.html" class="link">
                                    <i class="icon-calendar"></i>
                                    Calendar
                                </a>
                            </li>
                            <li role="presentation">
                                <a href="#" class="link">
                                    <i class="icon-inbox"></i>
                                    Inbox
                                </a>
                            </li>
                        </ul>
                    </li>-->
                    <li class="hidden-phone" id="user_login"><span></span><a href="javacript:void(0);" onclick="logout()"><i class="icon-signout"></i></a></li>
                </ul>
            </div>
        </div>
    </header>
    <div class="content container-fluid">
        <div id="middle-top" class="row-fluid">
            <div class="span12">
                <h4 class="page-title">Openstack <small></small></h4>
            </div>
        </div>
        <select id="control" style='display:none;width:160px;height:25px;margin-top: 10px;margin-right:20px;padding-top: 2px;'></select>
        <div class="row-fluid">
            <div class="span12">
                <div id="middle-left" class=''>
                    <div class="row-fluid">
                        <section class="widget">
                            <header style="padding-bottom: 20px;">
                                <h4 style="display: block;float: left;">
                                    <i class="icon-file-alt"></i>
                                   Add Openstack Controller
                                </h4>
                                <div style="display: block;float: right;"><button type="button" class="btn btn-primary btn-small" data-toggle="modal" data-target="#myModal2">Add controller</button></div>
                                <div id="myModal2" class="modal hide fade" tabindex="-1" role="dialog" style="background-color: rgba(61, 66, 68, 1);color:#fff">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" >×</button>
                                <h4 id="myModalLabel2" style="color:#fff">Add controller</h4>
                            </div>
                            <div class="modal-body">
                                <form id="user-form" class="form-horizontal label-right">
                                    <div class="control-group">
                                        <label class="control-label" for="ip">IP address</label>
                                        <div class="controls controls-row">
                                            <input type="text" id="ip" name="ip" class="span6">
                                        </div>
                                    </div>
                                </form>
                                
                            </div>
                            <div class="modal-footer" style="background-color: rgba(61, 66, 68, 1);">
                                <button class="btn" data-dismiss="modal">close</button>
                                <button class="btn btn-primary" onclick='add()'>commit</button>
                            </div>
                        </div>
                            </header>
                            <div class="body">
                        <table id="datatable-table3" class="table table-striped">
                            <thead>
                                <tr>
                                    <th>IP</th>
                                
                                    <th>operate</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                        </section>
                    </div>
                   
                   
                   <div class="row-fluid">
                        <section class="widget">
                            <header style="padding-bottom: 20px;">
                                <h4 style="display: block;float: left;">
                                    <i class="icon-file-alt"></i>
                                  Basic setting
                                </h4>
                                <div style="display: block;float: right;"><button type="button" class="btn btn-primary btn-small" onclick="updateConfig()">save</button></div>
                                <div style="display: block;float: right;"><button type="button" class="btn btn-success btn-small" onclick="searchConfig()">inquiry</button></div>
                                <div id="myModal2" class="modal hide fade" tabindex="-1" role="dialog" style="background-color: rgba(61, 66, 68, 1);color:#fff">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" >×</button>
                            </div>
                            <div class="modal-body">
                                <form id="user-form" class="form-horizontal label-right">
                                    <div class="control-group">
                                        <label class="control-label" for="ip">IP address</label>
                                        <div class="controls controls-row">
                                            <input type="text" id="ip" name="ip" class="span6">
                                        </div>
                                    </div>
                                </form>
                                
                            </div>
                        </div>
                            </header>
                            <div class="body">
                        <table id="datatable-table8" class="table table-striped">
                            <thead>
                                <tr>
                                    <th style="width:30%">function list</th>
                                
                                    <th>operate</th>
                                </tr>
                            </thead>
                            <tbody>
                             <tr><td>whether to allow to issued IP matching flow table</td><td><input type=radio id="ipflow1" name="ipflow" value="1"/>Yes<input type=radio id="ipflow0" name="ipflow" value="0"/>No</td></tr>
                             <tr><td>whether to allow to start initialization sFabric</td><td><input type=radio id="fabricon1" name="fabricon" value="1"/>Yes<input type=radio id="fabricon0" name="fabricon" value="0"/>No</td></tr>
                             <tr><td>whether to Open docking openstack</td><td><input type=radio id="openstackon1" name="openstackon" value="1"/>Yes<input type=radio id="openstackon0" name="openstackon" value="0"/>No</td></tr>
                             <tr><td>whether to support physical openflow switches</td><td><input type=radio id="physupport1" name="physupport" value="1"/>Yes<input type=radio id="physupport0" name="physupport" value="0"/>No</td></tr>
                             <tr><td>maximum number of switch connections</td><td><input type=text value="" id="maxswitch"/></td></tr>
                             <tr><td>maximum packet pool allowed per switch</td><td><input type=text value="" id="maxbuff"/></td></tr>
                             <tr><td>Maximum length of each packet</td><td><input type=text value="" id="maxlength"/></td></tr>
                            </tbody>
                        </table>
                    </div>
                        </section>
                    </div>
                   
                   
                    <div class="row-fluid">
                        <section class="widget">
                            <header style="padding-bottom: 20px;">
                                <h4 style="display: block;float: left;">
                                    <i class="icon-file-alt"></i>
                                    Network list
                                    </h4>
                                    <div style="display: block;float: right;"><button type="button" class="btn btn-primary btn-small" onclick="searchNetwork()">inquiry</button></div>
                                    </header>
                                     <div class="body">
                                <table id="datatable-table4" class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>name</th>
                                            <th>id</th>
                                            <th>whether to share</th>
                                            <th>type</th>
                                            <th>tenant id</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                                    </section>
                                    </div>
                           <div class="row-fluid">
                                    <section class="widget" style="">
                                    <header style="padding-bottom: 20px;">
                                    <h4 style="display: block;float: left;">
                                    <i class="icon-file-alt"></i>
                                 subnet list
                                    </h4>
                                    <div style="display: block;float: right;"><button type="button" class="btn btn-primary btn-small" onclick="searchSubnets()">inquiry</button></div>
                                    </header>
                                    <header style="padding-bottom: 10px;">
                                    <div style="display: block;float: left;margin-top:-20px">
                                    </div>
                                    </header>
                                     <div class="body">
                                <table id="datatable-table5" class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>name</th>
                                            <th>subnet id</th>
                                            <th>network id</th>
                                            <th>gateway</th>
                                            <th>tenant id</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                                     </section>
                                    </div>
                                    
                                     <div class="row-fluid">
                        <section class="widget">
                            <header style="padding-bottom: 20px;">
                                <h4 style="display: block;float: left;">
                                    <i class="icon-file-alt"></i>
                                    port list
                                    </h4>
                                    <div style="display: block;float: right;"><button type="button" class="btn btn-primary btn-small" onclick="searchPorts()">inquiry</button></div>
                                    </header>
                                     <div class="body">
                                <table id="datatable-table6" class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>gateway ip</th>
                                            <th>mac address</th>
                                            <th>subnet id</th>
                                            <th>port id</th>
                                            <th>tenant id</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                                    </section>
                                    </div>
                                    
                                     <div class="row-fluid">
                        <section class="widget">
                            <header style="padding-bottom: 20px;">
                                <h4 style="display: block;float: left;">
                                    <i class="icon-file-alt"></i>
                                                                                                                                      ounter network list
                                    </h4>
                                    <div style="display: block;float: right;">
                                    <button type="button" class="btn btn-success btn-small" onclick="updateExternal()">update port information</button>
                                    <button type="button" class="btn btn-primary btn-small" onclick="searchExternal()">inquiry</button></div>
                                    </header>
                                     <div class="body">
                                <table id="datatable-table7" class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>outer interface ip</th>
                                            <th>outer interface mac address</th>
                                            <th>outer network gateway</th>
                                             <th>outer network gateway mac</th>
                                            <th>operate</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                                    </section>
                                    </div>
                                    
                </div>
                
            </div>
        </div>
    </div>
</div>

<!-- jquery and friends -->
<script src="../js/jquery/jquery.1.9.0.min.js"> </script>
<script src="../js/jquery/jquery-migrate-1.1.0.min.js"> </script>
<!-- jquery plugins -->
<script src="../js/jquery/jquery.maskedinput.js"></script>
<script src="../js/parsley.js"> </script>
<script src="../js/jquery/jquery.uniform.js"></script>
<script src="../js/select2.js"></script>
<script src="../js/jquery/jquery.dataTables.min.js"></script>

<!-- bootstrap default plugins -->
<script src="../js/bootstrap/bootstrap-transition.js"></script>
<script src="../js/bootstrap/bootstrap-collapse.js"></script>
<script src="../js/bootstrap/bootstrap-alert.js"></script>
<script src="../js/bootstrap/bootstrap-tooltip.js"></script>
<script src="../js/bootstrap/bootstrap-popover.js"></script>
<script src="../js/bootstrap/bootstrap-button.js"></script>
<script src="../js/bootstrap/bootstrap-dropdown.js"></script>
<script src="../js/bootstrap/bootstrap-modal.js"></script>
<script src="../js/bootstrap/bootstrap-tab.js"> </script>

<!--backbone and friends -->
<script src="../js/underscore-min.js"></script>
<script src="../js/backbone-min.js"></script>
<script src="../js/backbone-pageable.js"></script>
<script src="../js/backgrid.js"></script>
<script src="../js/backgrid-paginator.js"></script>

<!-- page-specific js -->
<script src="../js/tables-dynamic.js"></script>

<!--chart-->


<script type="text/javascript">
    function getControl(obj){
        $.post("../control/list",{},function(data){
            if(data.status=="0"||data.status==0){
                data = data.data;
                var aaData = [];
                for(var i in data){                    
                    obj.append("<option value='"+data[i].ip+"|"+data[i].port+"'>"+data[i].ip+":"+data[i].port+"</option>")
                }
            }
        },"json");
    }
    function initDPID(value){
        $("#dpid").append("<option value='"+ value +"'>"+value+"</option>")
    }
    function searchHost(){
        var dpid = $("#dpid").val();
        var aaData = [];
        var total=0;
        for(var i in host){
            if(dpid == host[i].dpid){
                for(var n in host[i].host){
                    total = host[i].total;
                    aaData.push([host[i].host[n].ip,host[i].host[n].mac])
                }
            }
        }
        showTables(aaData,total);
        $("#datatable-table1").show();
    }
    function setupFabric(){
        var ip = $("#control").val().split("|")[0];
        var port = $("#control").val().split("|")[1];
        $.ajax({
            async:false,
            type: "POST",
            url: "../topology/setFabric",
            data: {ip:ip,port:port},
            dataType: "json",
            success: function(data){
                alert("success!");
            },
            error:function(){
                alert("error");
            }
        });
    }
    function delFabric(){
        var ip = $("#control").val().split("|")[0];
        var port = $("#control").val().split("|")[1];
        $.ajax({
            async:false,
            type: "POST",
            url: "../topology/deleteFabric",
            data: {ip:ip,port:port},
            dataType: "json",
            success: function(data){
                alert("success!");
            },
            error:function(){
                alert("error");
            }
        });
    }
    function partFabric(){
        var partF = $("#partF").val();
        $.ajax({
            async:false,
            type: "POST",
            url: "../topology/partFabric",
            data: {partF:partF},
            dataType: "json",
            success: function(data){
                alert("success!");
            },
            error:function(){
                alert("error");
            }
        });
    }
    function add(){
        var ip = $("#ip").val();
        $.post("../openstack/add",{ip:ip},function(data){
            if(data.status=="0"||data.status==0){
                if(data.data){
                    alert("add success！");
                    $("#myModal2").hide();
                    searchConfig();
                }else{
                    alert("add failed！");
                }
            }
        },'json');
    }
    function searchController(){
        $("#datatable-table3").hide();
        $.post("../openstack/list",{},function(data){
            if(data.status=="0"||data.status==0){
                data = data.data;
                for(var i in data){
                    var oper = "<button type='button' class='btn btn-danger btn-small' onclick='delController(" + JSON.stringify(data[i]) + ")''>delete</button>";
                    $("#datatable-table3 tbody").append("<tr><td>"+data[i]+"</td><td>"+oper+"</td></tr>");
                }
                $("#datatable-table3").show();
            }
        },"json");
    }
    function delController(controller){
        $.post("../openstack/delController",{controller:controller},function(data){
        	if(data.status=="0"||data.status==0){
                if(data.data){
                    alert("add success！");
                    searchConfig();
                }else{
                    alert("add failed！");
                }
            }
        },"json");
    }
    function searchNetwork(){
        $("#datatable-table4").hide();
        $.post("../openstack/allnetwork",{},function(data){
            if(data.status=="0"||data.status==0){
                data = data.data;
                $("#datatable-table4 tbody").html("");
                for(var i in data){
                   $("#datatable-table4 tbody").append("<tr><td>"+data[i]["name"]+"</td><td>"+data[i]["id"]+"</td><td>"+data[i]["shared"]+"</td><td>"+data[i]["provider:network_type"]+"</td><td>"+data[i]["tenant_id"]+"</td></tr>");
                }
                $("#datatable-table4").show();
            }
        },"json");
    }
    function searchSubnets(){
        $("#datatable-table5").hide();
        $.post("../openstack/allsubnets",{},function(data){
            if(data.status=="0"||data.status==0){
                data = data.data;
                $("#datatable-table5 tbody").html("");
                for(var i in data){
                   $("#datatable-table5 tbody").append("<tr><td>"+data[i]["name"]+"</td><td>"+data[i]["id"]+"</td><td>"+data[i]["network_id"]+"</td><td>"+data[i]["gateway_ip"]+"</td><td>"+data[i]["tenant_id"]+"</td></tr>");
                }
                $("#datatable-table5").show();
            }
        },"json");
    }
    function searchPorts(){
        $("#datatable-table6").hide();
        $.post("../openstack/allports",{},function(data){
            if(data.status=="0"||data.status==0){
                data = data.data;
                $("#datatable-table6 tbody").html("");
                for(var i in data){
                   $("#datatable-table6 tbody").append("<tr><td>"+data[i]["fixed_ips"][0]["ip_address"]+"</td><td>"+data[i]["mac_address"]+"</td><td>"+data[i]["fixed_ips"][0]["subnet_id"]+"</td><td>"+data[i]["id"]+"</td><td>"+data[i]["tenant_id"]+"</td></tr>");
                }
                $("#datatable-table6").show();
            }
        },"json");
    }
    function showNetCommand(str,bandDpid,bandPort){
       var ip = $("#control").val().split("|")[0];
       var port = $("#control").val().split("|")[1];
       $.post("../switchinfo",{ip:ip,port:port},function(data){
            if(data.status=="0"||data.status==0){
                data = data.data;
                var firstobj;
                $("#selectone"+str).html("<option></option>");
                $("#selecttwo"+str).html("<option></option>");
                for(var i in data){
                    var checked="";
                    if(data[i].dpid==bandDpid){
                      checked = "selected=selected";
                      firstobj = data[i].netport;
                    }
                    var obj = JSON.stringify(data[i].netport);
                    $("#selectone"+str).append("<option  value='"+obj+"' rel='"+data[i].dpid+"' "+checked+">"+data[i].ip+"("+data[i].dpid+")</option>");               
                }
                if(firstobj){
	                for(var i in firstobj){
	                    var checked="";
	                    if(firstobj[i].portNumber == bandPort){
	                       checked="selected=selected";
	                    }
	                    var portTenNumber ;
			            if (firstobj[i].portNumber == "fffffffe")
			                portTenNumber = "-1";
			            else
			                portTenNumber = parseInt(firstobj[i].portNumber,16).toString(10);
	                    var strr = "<option value='"+portTenNumber+"'  "+checked+">network interface number："+portTenNumber+"</option>";
	                   $("#selecttwo"+str).append(strr);
	                }
                }
            }
        },"json");
       $("#divone"+str).show();
       $("#btone"+str).hide();
    }
    function hideNetCommand(str){
       $("#divone"+str).hide();
       $("#btone"+str).show();
    }
    function showRoutePort(str){
       var obj =  JSON.parse($("#selectone"+str).val()) ;
       $("#selecttwo"+str).html("");
       for(var i in obj){
          var portTenNumber ;
          if (obj[i].portNumber == "fffffffe")
               portTenNumber = "-1";
           else
               portTenNumber = parseInt(obj[i].portNumber,16).toString(10);
          var strr = "<option value='"+portTenNumber+"'>network interface number："+portTenNumber+"</option>";
          $("#selecttwo"+str).append(strr);
       }
    }
    function submitRoutePort(str){
       var ip = $("#control").val().split("|")[0];
       var port = $("#control").val().split("|")[1];
       var dpid = $("#selectone"+str).find("option:selected").attr("rel");
       var bandport = $("#selecttwo"+str).val();
       var out_interface = $("#tdone"+str).html();
       $.post("../openstack/bandPort",{ip:ip,port:port,dpid:dpid,bandport:bandport,outip:out_interface},function(data){
            if(data.status=="0"||data.status==0){
             alert(data.data);   
            }
        },"json");
    }
    function searchExternal(){
        var ip = $("#control").val().split("|")[0];
        var port = $("#control").val().split("|")[1];
        $("#datatable-table7").hide();
        $.post("../openstack/allExternal",{ip:ip,port:port},function(data){
            if(data.status=="0"||data.status==0){
                data = data.data;
                $("#datatable-table7 tbody").html("");
                for(var i in data){
                   $("#datatable-table7 tbody").append("<tr><td id='tdone"+i+"' >"+data[i]["external_out_interface_ip"]+
                   "</td><td>"+data[i]["external_out_interface_mac"]+"</td><td>"+
                   data[i]["external_gateway_ip"]+"</td><td>"+
                   data[i]["external_gateway_mac"]+"</td><td>"+
                   "<button id='btone"+i+"' type='button' class='btn btn-success btn-small' onclick=showNetCommand("+i+",'"+data[i]["external_dpid"]+"','"+data[i]["external_port"]+"')>bound switch port</button>"+
                   "<div id='divone"+i+"' style='display:none'>"+
                   "<select id='selectone"+i+"' onchange='showRoutePort("+i+")'></select>"+
                   "<select id='selecttwo"+i+"'></select>"+
                   "<button id='bttwo"+i+"'type='button' class='btn btn-primary btn-small' onclick='submitRoutePort("+i+")'>bound</button>"+
                   "<button type='button' class='btn btn-success btn-small' onclick='hideNetCommand("+i+")'>cancel</button></div>"+
                   "</td></tr>");
                }
                $("#datatable-table7").show();
            }
        },"json");
    }
    function updateExternal(){
        var ip = $("#control").val().split("|")[0];
        var port = $("#control").val().split("|")[1];
        $.post("../openstack/updateExternal",{ip:ip,port:port},function(data){
            if(data.status=="0"||data.status==0){
                alert(data.data);   
            }
        },"json");
    }
     function updateConfig(){
        var ip = $("#control").val().split("|")[0];
        var port = $("#control").val().split("|")[1];
        var ipflow = $("input:radio[name='ipflow']:checked").val(); 
        var fabricon = $("input:radio[name='fabricon']:checked").val(); 
        var openstackon = $("input:radio[name='openstackon']:checked").val(); 
        var physupport = $("input:radio[name='physupport']:checked").val(); 
        var maxswitch = $("#maxswitch").val(); 
        var maxbuff = $("#maxbuff").val();
        var maxlength = $("#maxlength").val();
        
        $.post("../openstack/updateConfig",{ip:ip,port:port,ipflow:ipflow,fabricon:fabricon,openstackon:openstackon,physupport:physupport,maxswitch:maxswitch,maxbuff:maxbuff,maxlength:maxlength},function(data){
            if(data.status=="0"||data.status==0){
                alert("success!");
            }
        },"json");
    }
    function searchConfig(){
        var ip = $("#control").val().split("|")[0];
        var port = $("#control").val().split("|")[1];
        $.post("../openstack/searchConfig",{ip:ip,port:port},function(data){
            if(data.status=="0"||data.status==0){
                var allconfig = data.data;
                $("#ipflow"+allconfig["ip_match_flows"]+"").attr("checked","checked");
                $("#fabricon"+allconfig["auto_fabric"]+"").attr("checked","checked"); 
                $("#openstackon"+allconfig["openvstack_on"]+"").attr("checked","checked"); 
                $("#physupport"+allconfig["use_phy"]+"").attr("checked","checked"); 
                $("#maxswitch").val(allconfig["max_switch"]);
                $("#maxbuff").val(allconfig["buff_num"]);
                $("#maxlength").val(allconfig["buff_len"]);
            }
        },"json");
    }
    function search(){
        $("#dpid").html("");
        nodes = [];
        links = [];
        var ip = $("#control").val().split("|")[0];
        var port = $("#control").val().split("|")[1];
        $.ajax({
            async:false,
            type: "POST",
            url: "../topology/link",
            data: {ip:ip,port:port},
            dataType: "json",
            success: function(data){
                if(data.status=="0"||data.status==0){
                    //添加交换机节点
                    var rNodes = data.data.nodes;
                    for (var ri in rNodes) {
                        nodes.push({category:0, name: rNodes[ri], symbolSize:30});
                    }
                    
                    // 添加关系
                    data = data.data.relation;
                    var aaData = [];
                    for(var i in data){
                        var obj = [
                            data[i].src_switch,
                            data[i].src_port,
                            data[i].dst_switch,
                            data[i].dst_port
                        ]
                        var link = {
                            source : data[i].src_switch, 
                            target : data[i].dst_switch
                        }
                        aaData.push(obj);
                        links.push(link)
                        nodes.push({category:0, name: data[i].src_switch, symbolSize:30});
                        nodes.push({category:0, name: data[i].dst_switch, symbolSize:30});
                    }
                    showTable(aaData);
                    $("#datatable-table").show();
                    $(".hostbody").show();
                }
            },
            error:function(){
                alert("error")
            }
        });
        $.ajax({
            async:false,
            type: "POST",
            url: "../topology/host",
            data: {ip:ip,port:port},
            dataType: "json",
            success: function(data){
                if(data.status=="0"||data.status==0){
                    //添加交换机节点
                    var rNodes = data.data.nodes;
                    for (var ri in rNodes) {
                        nodes.push({category:0, name: rNodes[ri], symbolSize:30});
                    }
                    
                    data = data.data.relation;
                    var aaData = [];
                    for(var i in data){
                        nodes.push({category:0, name: data[i].dpid, symbolSize:30});
                        for(var n in data[i].hosts){
                            nodes.push({category:1, name: data[i].hosts[n].ip, symbolSize:15});
                            links.push({source : data[i].dpid, target : data[i].hosts[n].ip})
                        }
                        host.push({dpid:data[i].dpid+"|"+data[i].port,host:data[i].hosts,total:data[i].total})
                        initDPID(data[i].dpid+"|"+data[i].port);
                    }
                }
                nodes = _.uniq(nodes, false, function(obj){return obj.name;});
                $("#chart").html("");
                showChart(nodes,links);
            },
            error:function(){
                alert("error")
            }
        });
    }
    var nodes = [];
    var links = [];
    var host = [];
    $(function(){
        $("#user_login span").html(user);
        $("#datatable-table").hide();
        $("#datatable-table1").hide();
        $(".hostbody").hide();
        getControl($("#control"));
        searchController();
    })
</script>
</body>
</html>