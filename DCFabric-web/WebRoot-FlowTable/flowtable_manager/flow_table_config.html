<!DOCTYPE html>
<html>

<head>
    <title>system configuration</title>
    <link href="../css/application.min.css" rel="stylesheet">
    <link rel="shortcut icon" href="img/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta charset="utf-8">
    <script src="../js/cookie.js"></script>
    <script>
        var user = getCookie("user");
        if (user) {
            addCookie("user", user);
        } else {
            window.location = "../login.html";
        }
    </script>
</head>

<body class="background-dark">
<div class="logo">
    <h2 class="page-title">
        <img src="../img/telecom.png" style="width:50px;position: relative;top: -7px;"> DCFabric
        <small>configuration managment</small>
    </h2>
</div>
<nav id="sidebar" class="sidebar nav-collapse collapse">
    <ul id="side-nav" class="side-nav">
        <li class='accordion-group'>
            <a href="../cluster_config/cluster_config.html">
                <i class="icon-desktop"></i>
                <span class="name">cluster configuration</span>
            </a>
        </li>
        <li class='accordion-group '>
            <a href="../interchanger_desc/interchanger_desc.html">
                <i class="icon-desktop"></i>
                <span class="name">switch information</span>
            </a>
        </li>
        <li class='accordion-group '>
            <a href="../hostinfo/index.html">
                <i class="icon-desktop"></i>
                <span class="name">host information</span>
            </a>
        </li>
        <li class='accordion-group'>
            <a href="../chart/chart.html">
                <i class="icon-desktop"></i>
                <span class="name">network topo</span>
            </a>
        </li>
        <!--   <li class='accordion-group'>
        <a href="../flow_table_config/flow_table_config.html"><i class="icon-desktop"></i> <span class="name">flow configuration</span></a>
    </li>
    <li class="accordion-group">
        <a href="../firewall_manager/firewall_config.html"><i class="icon-desktop"></i> <span class="name">firewall management</span></a>
    </li>
    <li class='accordion-group'>
        <a href="../gateway_config/gateway_config.html"><i class="icon-desktop"></i> <span class="name">L3 gateway configuration</span></a>
    </li>
    <li class='accordion-group'>
        <a href="../meter_table_config/meter_table_config.html"><i class="icon-desktop"></i> <span class="name">meter table configuration</span></a>
    </li>
    <li class='accordion-group'>
        <a href="../group_table_config/group_table_config.html"><i class="icon-desktop"></i> <span class="name">group table configuration</span></a>
    </li>
    <li class='accordion-group'>
        <a href="../multitenant_manage/renant_config.html"><i class="icon-desktop"></i> <span class="name">tenant managent</span></a>
    </li> 
        <li class='accordion-group'>
            <a href="../open_manage/openstack_main.html">
                <i class="icon-desktop"></i>
                <span class="name">openstack</span>
            </a>
        </li> -->
        <li class='accordion-group active'>
            <a href="../flowtable_manager/flow_table_config.html">
                <i class="icon-desktop"></i>
                <span class="name">flowtable</span>
            </a>
        </li>
</nav>
<div class="wrap">
    <header class="page-header">
        <div class="navbar">
            <div class="navbar-inner">
                <ul class="nav pull-right">
                    <!--<li class="hidden-phone dropdown">
                    <a href="#" title="Account" id="account"
                       class="dropdown-toggle"
                       data-toggle="dropdown">
                        <i class="icon-user"></i>
                    </a>
                    <ul id="account-menu" class="dropdown-menu account" role="menu">
                        <li role="presentation" class="account-picture">
                            <img src="../img/2.jpg" alt="">
                            Philip Daineka
                        </li>
                        <li role="presentation">
                            <a href="form_account.html" class="link">
                                <i class="icon-user"></i>
                                Profile
                            </a>
                        </li>
                        <li role="presentation">
                            <a href="component_calendar.html" class="link">
                                <i class="icon-calendar"></i>
                                Calendar
                            </a>
                        </li>
                        <li role="presentation">
                            <a href="#" class="link">
                                <i class="icon-inbox"></i>
                                Inbox
                            </a>
                        </li>
                    </ul>
                </li>-->
                    <li class="hidden-phone" id="user_login">
                        <span></span>
                        <a href="javascript:void(0);" onclick="logout();">
                            <i class="icon-signout"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </header>
    <div class="content container-fluid">
        <div class="row-fluid">
            <div class="span12">
                <h4 class="page-title">Switch information
                    <small>view witch information</small>
                </h4>
            </div>
        </div>
        <div class="row-fluid">
            <div class="span12">
                <section class="widget">
                    <header style="padding-bottom: 20px;">
                        <h4 style="display: block;float: left;">
                            <i class="icon-file-alt"></i>
                            Switch Information Inquiry
                        </h4>
                        <div style="display: block;float: right;">
                            Controller IPï¼š
                            <!-- <input type='text' style='width:80px;height:15px;margin-top: 10px;margin-right:20px;'> -->
                            <select id="control" style='width:160px;height:25px;margin-top: 10px;margin-right:20px;padding-top: 2px;'></select>
                            <button type="button" class="btn btn-success btn-small" onclick="search()">Inquiry</button>
                        </div>
                    </header>
                    <div class="body">
                        <table id="datatable-table" class="table table-striped dataTable">
                            <thead>
                            <tr>

                                <th>dpid</th>
                                <th>IP address</th>
                                <th>port</th>
                                <th>manufacturer</th>
                                <th>software version</th>
                                <th>hardware version</th>
                                <th>protocol version</th>
                                <th>operate</th>
                            </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </section>
            </div>
        </div>
    </div>
</div>

<!-- jquery and friends -->
<script src="../js/jquery/jquery.1.9.0.min.js">
</script>
<script src="../js/jquery/jquery-migrate-1.1.0.min.js">
</script>
<!-- jquery plugins -->
<script src="../js/jquery/jquery.maskedinput.js"></script>
<script src="../js/parsley.js">
</script>
<script src="../js/jquery/jquery.uniform.js"></script>
<script src="../js/select2.js"></script>
<script src="../js/jquery/jquery.dataTables.min.js"></script>

<!-- bootstrap default plugins -->
<script src="../js/bootstrap/bootstrap-transition.js"></script>
<script src="../js/bootstrap/bootstrap-collapse.js"></script>
<script src="../js/bootstrap/bootstrap-alert.js"></script>
<script src="../js/bootstrap/bootstrap-tooltip.js"></script>
<script src="../js/bootstrap/bootstrap-popover.js"></script>
<script src="../js/bootstrap/bootstrap-button.js"></script>
<script src="../js/bootstrap/bootstrap-dropdown.js"></script>
<script src="../js/bootstrap/bootstrap-modal.js"></script>
<script src="../js/bootstrap/bootstrap-tab.js">
</script>

<!--backbone and friends -->
<script src="../js/underscore-min.js"></script>
<script src="../js/backbone-min.js"></script>
<script src="../js/backbone-pageable.js"></script>
<script src="../js/backgrid.js"></script>
<script src="../js/backgrid-paginator.js"></script>

<!-- page-specific js -->
<script src="../js/tables-dynamic.js"></script>
<script type="text/javascript">
    var mockdata = false;

    function getControl(callback) {
        $.post("../control/list", {}, function (data) {
            if (data.status == "0" || data.status == 0) {
                data = data.data;
                var aaData = [];
                for (var i in data) {
                    $("#control").append("<option value='" + data[i].ip + ":" + data[i].port + "'>" + data[
                        i].ip + ":" + data[i].port + "</option>")
                }
                if (callback) {
                    callback();
                }
            }
        }, "json").always(function () {
            if (mockdata == true) {
                var data = [{
                    ip: "1.1.1.1",
                    port: 22
                }]
                for (var i in data) {
                    $("#control").append("<option value='" + data[i].ip + "|" + data[i].port + "'>" + data[
                        i].ip + ":" + data[i].port + "</option>")
                }
            }
        })
    }
    // function searchNetPort(obj){
    //     var cont = "";
    //     for(var i in obj){
    //         var portTenNumber ;
    //         if (obj[i].portNumber == "fffffffe")
    //             portTenNumber = "LOCAL";
    //         else
    //             portTenNumber = parseInt(obj[i].portNumber,16).toString(10);
    //         cont += "<div class='span4' style='margin-left:0px;padding: 5px;width: 250px;border-bottom: 1px solid #cccccc;'>"
    //         cont +=     "<p>interface name:"+obj[i].name+"</p>";
    //         cont +=     "<p>interface number:"+portTenNumber+"</p>";
    //         cont +=     "<p>MAC address:"+obj[i].hardwareAddress+"</p>";
    //         cont += "</div>";
    //     }
    //     $("#netport").html("");
    //     $("#netport").append(cont);
    //     $("#myModal2").modal('show');
    // }
    function onCickViewButton(dpid) {

        window.location = "./flow_table_detail.html?dpid=" +dpid.dpid+"&controller="+$("#control").val();
    }

    function search() {
        window.location = "./flow_table_config.html?control=" + $("#control").val()

    }

    function getURLParam(key) {
        var reg = new RegExp("(\\?|&)" + key + "=([^&]*)(&|$)", "i");
        var rs = window.location.search.match(reg);
        if (rs) {
            return unescape(rs[2]);
        }
    }

    $(function () {
        $("#user_login span").html(user);
        $("#datatable-table").hide();

        getControl(function () {
            var control = getURLParam("control");

            if (control) {
                $("#control").val(control);
            }
            var ip = $("#control").val().split(":")[0];
            var port = $("#control").val().split(":")[1];
            $.post("../switchinfo", {
                ip: ip,
                port: port
            }, function (data) {
                if (data.status == "0" || data.status == 0) {
                    data = data.data;
                    var aaData = [];
                    for (var i in data) {
                        var oper =
                            "<button type='button' class='btn btn-success btn-small' onclick='onCickViewButton(" +JSON.stringify({dpid:data[i].dpid}) + ")'>View Flow table </button>"
                        var obj = [
                            data[i].dpid,
                            data[i].ip,
                            data[i].port,
                            data[i].manufacturer,
                            data[i].software,
                            data[i].hardware,
                            data[i].openflow,
                            oper
                        ];
                        aaData.push(obj);
                    }
                    showTable(aaData);
                    $("#datatable-table").show();
                    $("#datatable-table").css("width", "100%");
                } else {
                    alert(data.data)
                }
            }, "json")
        });
    })
</script>
</body>

</html>